<!DOCTYPE html>
<!---------------------------------------------------------------------------
Title: Google Play Books Global Pricing tool
Description: A tool for checking ebook and print pricing for books on the 
            Google Play store for various countries.
Author: Knuxchan
Website: https://github.com/Knuxchan/gp-global-book-pricing-tool

MIT License

Copyright (c) 2023 Knuxchan

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
---------------------------------------------------------------------------->

<html lang="en">
    <head>
        <title>Google Play Books Global Pricing Tool</title>
        <meta charset="utf-8">
	    <meta name="viewport" content="width=device-width, user-scalable=no">

        <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bottleneck@2.19.5/light.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js" integrity="sha512-2ImtlRlf2VVmiGZsjm9bEyhjGW4dU7B6TNwh/hx/iSByxNENtj3WVE6o/9Lj4TJeVXPi4bnOIMXFIJJAeufa0A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" integrity="sha512-nMNlpuaDPrqlEls3IX/Q56H36qvBASwb3ipuo3MxeWbsQB1881ox0cRv7UPTgBlriqoynt35KjEwgGUeUXIPnw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans">
        
        <style>
            body {
                margin: 0;
                padding: 2rem;
                padding-top: 0px;
                font-family: "Open Sans", sans-serif;
            }

            table {
                text-align: left;
                position: relative;
                border-collapse: collapse; 
            }
            th, td {
                padding: 0.25rem;
            }
            table, th, tr, td {
                border: 1px solid black;
            }
            th {
                background: white;
                position: sticky;
                top: 160; /* Don't forget this, required for the stickiness */
                box-shadow: 0 2px 2px -1px rgba(0, 0, 0, 0.4);
            }
            div.sticky-entry {
                background: white;
                position: sticky;
                top: 0;
                z-index: 999;
                padding: 10px;
            }
            #book-table th:hover {
                cursor: pointer;
            }

            /* Loader */
            .spanner {
                position:absolute;
                top: 50%;
                left: 0;
                background: transparent;
                width: 100%;
                display:block;
                text-align:center;
                height: 300px;
                color: #FFF;
                transform: translateY(-50%);
                z-index: 999999;
                visibility: hidden;
            }

            .overlay {
                position: fixed;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.9);
                visibility: hidden;
                z-index: 9999;
                left: 0;
            }

            .loader,
            .loader:before,
            .loader:after {
                border-radius: 50%;
                width: 2.5em;
                height: 2.5em;
                -webkit-animation-fill-mode: both;
                animation-fill-mode: both;
                -webkit-animation: load7 1.8s infinite ease-in-out;
                animation: load7 1.8s infinite ease-in-out;
            }
            .loader {
                color: #ffffff;
                font-size: 10px;
                margin: 80px auto;
                position: relative;
                text-indent: -9999em;
                -webkit-transform: translateZ(0);
                -ms-transform: translateZ(0);
                transform: translateZ(0);
                -webkit-animation-delay: -0.16s;
                animation-delay: -0.16s;
            }
            .loader:before,
            .loader:after {
                content: '';
                position: absolute;
                top: 0;
            }
            .loader:before {
                left: -3.5em;
                -webkit-animation-delay: -0.32s;
                animation-delay: -0.32s;
            }
            .loader:after {
                left: 3.5em;
            }
            @-webkit-keyframes load7 {
                0%,
                80%,
                100% {
                    box-shadow: 0 2.5em 0 -1.3em;
                }
                40% {
                    box-shadow: 0 2.5em 0 0;
                }
                }
                @keyframes load7 {
                0%,
                80%,
                100% {
                    box-shadow: 0 2.5em 0 -1.3em;
                }
                40% {
                    box-shadow: 0 2.5em 0 0;
                }
            }

            .show {
                visibility: visible;
            }

            .spanner, .overlay {
                opacity: 0;
                -webkit-transition: all 0.3s;
                -moz-transition: all 0.3s;
                transition: all 0.3s;
            }

            .spanner.show, .overlay.show {
                opacity: 1
            }
        </style>
    </head>

    <body>
        <script>
            // Force reqests to be 'bottlenecked' to prevent 429 'too many requests' error
            const bottleneck = new Bottleneck({
                minTime: 2500, //minimum time between requests
                maxConcurrent: 3, //maximum concurrent requests
            });

            async function generate_price(response) {
                $("div.spanner").removeClass("show");
                $("div.overlay").removeClass("show");
                
                if (!response || !response.contents) return;

                // Make sure book is available in the chosen country, otherwise show 'unavailable' notification on the table
                if (response.status.http_code === 403) {
                    const unavailable_country = countries[response.status.url.split('&gl=').pop().toUpperCase()];
                    let html = `
                        <tr>
                            <td colspan="7" style="background-color: #E8E8E8">This book is currently unavailable in ${unavailable_country}. (<a target=_blank title="(opens in a new window)" href="${response.status.url}">See details</a>)</td>
                        </tr>
                    `;
                    $('.book-table').append(html);
                } else {
                    const res = response.contents;
                    const book_title = $(res).find('h1[itemprop="name"]')[0].textContent;
                    const author_list = $(res).find('span[itemprop="author"]')[0].parentElement;
                    const author_names = [];

                    for (let i in author_list.children) {
                        const text_content = author_list.children[i].textContent;
                        if (text_content && text_content.trim().length > 1)
                            author_names.push(text_content);
                    }

                    let price = $(res).find('meta[itemprop="price"]')[0];
                    price = price ? price.getAttribute('content') : null;
                    
                    let orig_price = $(res).find('span.y0Muaf')[0];
                    orig_price = orig_price ? orig_price.textContent : null;

                    let currency_abbr = null;
                    let country_abbr = null;
                    
                    const country = $(res).find('div.yVZQTb')[0].textContent.split(/[\(]+/gm)[0].trim();

                    if (price && price !== '0' && price.length) {
                        const currency_symbol = price.split(/[ 0-9. ]/g).filter(Boolean).pop();
                        for (const [key, value] of Object.entries(currency_symbols)) {
                            if (value === currency_symbol) currency_abbr = key;
                        }
                        if (!currency_abbr) currency_abbr = '-- (unknown currency)';
                    } else if (!price) {
                        price = ' -- ';
                    }

                    // Get Country Abbreviation
                    for (const [key, value] of Object.entries(countries)) {
                        if (value === country) country_abbr = key;
                    }

                    // Do something special for free books
                    if (price === '0') price = '<strong>FREE!</strong>';

                    const book_id = $('[name="book_id"]').val();

                    let html = `
                        <tr>
                            <td><a target=_blank title="(opens in a new window)" href="https://play.google.com/store/books/details?id=${book_id}&gl=${country_abbr ? country_abbr.toLowerCase() : ''}">(View)</a> ${book_title}</td>
                            <td>${author_names.join(', ')}</td>
                            <td>${country ? country : ' -- '}</td>
                            <td>${country_abbr ? country_abbr : ' -- '}</td>
                        `;

                    if (price && orig_price) {
                        html += `
                            <td>${orig_price}</td>
                            <td><span style="font-weight: bold; color: #4CAF50">${price}</span></td>
                        `;
                    } else if (price && !orig_price) {
                        html += `
                            <td>${price}</td>
                            <td>--</td>
                        `;
                    } else if (!price && orig_price) {
                        html += `
                            <td>--</td>
                            <td><span style="font-weight: bold; color: #4CAF50">${orig_price}</span></td>
                        `;
                    } else {
                        html += `
                            <td>--</td>
                            <td>--</td>
                        `;
                    }

                    html += `
                            <td>${country_abbr ? country_to_currency[countries[country_abbr].toUpperCase()] : ' -- '}</td>
                        </tr>
                    `;
                    
                    $('.book-table').append(html);
                }

                task();
                loadingBarStatus(loader_counter++, num_urls);
            }

            async function get_prices() {
                const book_id = $('[name="book_id"]').val();
                if (!book_id) return;

                const countries_selected = $('select#country_select').val();
                if (!countries_selected) return;

                loader_counter = 1;

                const url = `https://api.allorigins.win/get?callback=generate_price&url=`;
                const url_array = [];
                
                countries_selected.forEach((v, i) => {
                    const country_lower = v.toLowerCase();
                    url_array.push(url + encodeURIComponent('https://play.google.com/store/books/details?id=' + book_id + '&gl=' + country_lower));
                });

                current = 0;
                num_urls = url_array.length;

                process_links(url_array);
            }

            async function process_links(urls) {
                await Promise.all(urls.map(async (link, i) => {
                    const script = document.createElement('script');
                    script.src = link;
                    script.async = false;
                    script.crossorigin = "anonymous";

                    let html = `
                        <thead>
                            <tr class="table-header">
                                <th onclick="sortTable(0)">Title</th>
                                <th onclick="sortTable(1)">Author(s)</th>
                                <th onclick="sortTable(2)">Country Name</th>
                                <th onclick="sortTable(3)">Country Abbreviation</th>
                                <th onclick="sortTable(4)">Retail Price</th>
                                <th onclick="sortTable(5)">Discount Price</th>
                                <th onclick="sortTable(6)">Currency Code</th>
                            </tr>
                        </thead>
                        <tbody>
                    `;

                    bottleneck.schedule(() => {
                        setTimeout(() => {
                            document.head.appendChild(script);
                        }, '3000');
                    });

                    html += '</tbody>';
                    $('.book-table').html(html);

                    loadingBar.textContent = `Loading....`;
                }));
            }

            let loader_counter = 1;
            let num_urls = 0;

            // Currency symbols
            var currency_symbols = {
                'AED': 'د.إ',
                'AFN': '؋',
                'ALL': 'L',
                'AMD': '֏',
                'ANG': 'ƒ',
                'AOA': 'Kz',
                'ARS': '$',
                'AUD': '$',
                'AWG': 'ƒ',
                'AZN': '₼',
                'BAM': 'KM',
                'BBD': '$',
                'BDT': '৳',
                'BGN': 'лв',
                'BHD': '.د.ب',
                'BIF': 'FBu',
                'BMD': '$',
                'BND': '$',
                'BOB': '$b',
                'BRL': 'R$',
                'BSD': '$',
                'BTC': '฿',
                'BTN': 'Nu.',
                'BWP': 'P',
                'BYR': 'Br',
                'BYN': 'Br',
                'BZD': 'BZ$',
                'CAD': '$',
                'CDF': 'FC',
                'CHF': 'CHF',
                'CLP': '$',
                'CNY': '¥',
                'COP': '$',
                'CRC': '₡',
                'CUC': '$',
                'CUP': '₱',
                'CVE': '$',
                'CZK': 'Kč',
                'DJF': 'Fdj',
                'DKK': 'kr',
                'DOP': 'RD$',
                'DZD': 'دج',
                'EEK': 'kr',
                'EGP': '£',
                'ERN': 'Nfk',
                'ETB': 'Br',
                'ETH': 'Ξ',
                'EUR': '€',
                'FJD': '$',
                'FKP': '£',
                'GBP': '£',
                'GEL': '₾',
                'GGP': '£',
                'GHC': '₵',
                'GHS': 'GH₵',
                'GIP': '£',
                'GMD': 'D',
                'GNF': 'FG',
                'GTQ': 'Q',
                'GYD': '$',
                'HKD': '$',
                'HNL': 'L',
                'HRK': 'kn',
                'HTG': 'G',
                'HUF': 'Ft',
                'IDR': 'Rp',
                'ILS': '₪',
                'IMP': '£',
                'INR': '₹',
                'IQD': 'ع.د',
                'IRR': '﷼',
                'ISK': 'kr',
                'JEP': '£',
                'JMD': 'J$',
                'JOD': 'JD',
                'JPY': '¥',
                'KES': 'KSh',
                'KGS': 'лв',
                'KHR': '៛',
                'KMF': 'CF',
                'KPW': '₩',
                'KRW': '₩',
                'KWD': 'KD',
                'KYD': '$',
                'KZT': 'лв',
                'LAK': '₭',
                'LBP': '£',
                'LKR': '₨',
                'LRD': '$',
                'LSL': 'M',
                'LTC': 'Ł',
                'LTL': 'Lt',
                'LVL': 'Ls',
                'LYD': 'LD',
                'MAD': 'MAD',
                'MDL': 'lei',
                'MGA': 'Ar',
                'MKD': 'ден',
                'MMK': 'K',
                'MNT': '₮',
                'MOP': 'MOP$',
                'MRO': 'UM',
                'MRU': 'UM',
                'MUR': '₨',
                'MVR': 'Rf',
                'MWK': 'MK',
                'MXN': '$',
                'MYR': 'RM',
                'MZN': 'MT',
                'NAD': '$',
                'NGN': '₦',
                'NIO': 'C$',
                'NOK': 'kr',
                'NPR': '₨',
                'NZD': '$',
                'OMR': '﷼',
                'PAB': 'B/.',
                'PEN': 'S/.',
                'PGK': 'K',
                'PHP': '₱',
                'PKR': '₨',
                'PLN': 'zł',
                'PYG': 'Gs',
                'QAR': '﷼',
                'RMB': '￥',
                'RON': 'lei',
                'RSD': 'Дин.',
                'RUB': '₽',
                'RWF': 'R₣',
                'SAR': '﷼',
                'SBD': '$',
                'SCR': '₨',
                'SDG': 'ج.س.',
                'SEK': 'kr',
                'SGD': '$',
                'SHP': '£',
                'SLL': 'Le',
                'SOS': 'S',
                'SRD': '$',
                'SSP': '£',
                'STD': 'Db',
                'STN': 'Db',
                'SVC': '$',
                'SYP': '£',
                'SZL': 'E',
                'THB': '฿',
                'TJS': 'SM',
                'TMT': 'T',
                'TND': 'د.ت',
                'TOP': 'T$',
                'TRL': '₤',
                'TRY': '₺',
                'TTD': 'TT$',
                'TVD': '$',
                'TWD': 'NT$',
                'TZS': 'TSh',
                'UAH': '₴',
                'UGX': 'USh',
                'USD': '$',
                'UYU': '$U',
                'UZS': 'лв',
                'VEF': 'Bs',
                'VND': '₫',
                'VUV': 'VT',
                'WST': 'WS$',
                'XAF': 'FCFA',
                'XBT': 'Ƀ',
                'XCD': '$',
                'XOF': 'CFA',
                'XPF': '₣',
                'YER': '﷼',
                'ZAR': 'R',
                'ZWD': 'Z$'
            }

            // Country abbreviations
            const country_abbrs = ["AR", "AU", "AT", "BH", "BY", "BE", "BO", "BR", "CA", "CL", "CO", "CR", "CZ", "DK", "DO", "EC", "EG", "SV", "EE", "FI", "FR", "DE", "GR", "GT", "HN", "HK", "HU", "IN", "ID", "IE", "IT", "JP", "JO", "KZ", "KW", "KG", "LV", "LB", "LT", "LU", "MY", "MX", "NL", "NZ", "NI", "NO", "OM", "PA", "PY", "PE", "PH", "PL", "PT", "QA", "RO", "RU", "SA", "SG", "SK", "ZA", "KR", "ES", "SE", "CH", "TW", "TH", "TR", "UA", "AE", "GB", "US", "UY", "UZ", "VE", "VN"];

            // Country full names
            const countries = {
                    AF: 'Afghanistan',
                    AX: 'Aland Islands',
                    AL: 'Albania',
                    DZ: 'Algeria',
                    AS: 'American Samoa',
                    AD: 'Andorra',
                    AO: 'Angola',
                    AI: 'Anguilla',
                    AG: 'Antigua And Barbuda',
                    AR: 'Argentina',
                    AM: 'Armenia',
                    AW: 'Aruba',
                    AU: 'Australia',
                    AT: 'Austria',
                    AZ: 'Azerbaijan',
                    BS: 'Bahamas',
                    BH: 'Bahrain',
                    BD: 'Bangladesh',
                    BB: 'Barbados',
                    BY: 'Belarus',
                    BE: 'Belgium',
                    BZ: 'Belize',
                    BJ: 'Benin',
                    BM: 'Bermuda',
                    BT: 'Bhutan',
                    BO: 'Bolivia',
                    BA: 'Bosnia And Herzegovina',
                    BW: 'Botswana',
                    BV: 'Bouvet Island',
                    BR: 'Brazil',
                    IO: 'British Indian Ocean Territory',
                    BN: 'Brunei Darussalam',
                    BG: 'Bulgaria',
                    BF: 'Burkina Faso',
                    BI: 'Burundi',
                    KH: 'Cambodia',
                    CM: 'Cameroon',
                    CA: 'Canada',
                    CV: 'Cape Verde',
                    KY: 'Cayman Islands',
                    CF: 'Central African Republic',
                    TD: 'Chad',
                    CL: 'Chile',
                    CN: 'China',
                    CX: 'Christmas Island',
                    CC: 'Cocos (Keeling) Islands',
                    CO: 'Colombia',
                    KM: 'Comoros',
                    CG: 'Congo',
                    CD: 'Congo, Democratic Republic',
                    CK: 'Cook Islands',
                    CR: 'Costa Rica',
                    CI: 'Cote D\'Ivoire',
                    HR: 'Croatia',
                    CU: 'Cuba',
                    CY: 'Cyprus',
                    CZ: 'Czechia',
                    DK: 'Denmark',
                    DJ: 'Djibouti',
                    DM: 'Dominica',
                    DO: 'Dominican Republic',
                    EC: 'Ecuador',
                    EG: 'Egypt',
                    SV: 'El Salvador',
                    GQ: 'Equatorial Guinea',
                    ER: 'Eritrea',
                    EE: 'Estonia',
                    ET: 'Ethiopia',
                    FK: 'Falkland Islands (Malvinas)',
                    FO: 'Faroe Islands',
                    FJ: 'Fiji',
                    FI: 'Finland',
                    FR: 'France',
                    GF: 'French Guiana',
                    PF: 'French Polynesia',
                    TF: 'French Southern Territories',
                    GA: 'Gabon',
                    GM: 'Gambia',
                    GE: 'Georgia',
                    DE: 'Germany',
                    GH: 'Ghana',
                    GI: 'Gibraltar',
                    GR: 'Greece',
                    GL: 'Greenland',
                    GD: 'Grenada',
                    GP: 'Guadeloupe',
                    GU: 'Guam',
                    GT: 'Guatemala',
                    GG: 'Guernsey',
                    GN: 'Guinea',
                    GW: 'Guinea-Bissau',
                    GY: 'Guyana',
                    HT: 'Haiti',
                    HM: 'Heard Island & Mcdonald Islands',
                    VA: 'Holy See (Vatican City State)',
                    HN: 'Honduras',
                    HK: 'Hong Kong',
                    HU: 'Hungary',
                    IS: 'Iceland',
                    IN: 'India',
                    ID: 'Indonesia',
                    IR: 'Iran, Islamic Republic Of',
                    IQ: 'Iraq',
                    IE: 'Ireland',
                    IM: 'Isle Of Man',
                    IL: 'Israel',
                    IT: 'Italy',
                    JM: 'Jamaica',
                    JP: 'Japan',
                    JE: 'Jersey',
                    JO: 'Jordan',
                    KZ: 'Kazakhstan',
                    KE: 'Kenya',
                    KI: 'Kiribati',
                    KR: 'South Korea',
                    KW: 'Kuwait',
                    KG: 'Kyrgyzstan',
                    LA: 'Lao People\'s Democratic Republic',
                    LV: 'Latvia',
                    LB: 'Lebanon',
                    LS: 'Lesotho',
                    LR: 'Liberia',
                    LY: 'Libyan Arab Jamahiriya',
                    LI: 'Liechtenstein',
                    LT: 'Lithuania',
                    LU: 'Luxembourg',
                    MO: 'Macao',
                    MK: 'Macedonia',
                    MG: 'Madagascar',
                    MW: 'Malawi',
                    MY: 'Malaysia',
                    MV: 'Maldives',
                    ML: 'Mali',
                    MT: 'Malta',
                    MH: 'Marshall Islands',
                    MQ: 'Martinique',
                    MR: 'Mauritania',
                    MU: 'Mauritius',
                    YT: 'Mayotte',
                    MX: 'Mexico',
                    FM: 'Micronesia, Federated States Of',
                    MD: 'Moldova',
                    MC: 'Monaco',
                    MN: 'Mongolia',
                    ME: 'Montenegro',
                    MS: 'Montserrat',
                    MA: 'Morocco',
                    MZ: 'Mozambique',
                    MM: 'Myanmar',
                    NA: 'Namibia',
                    NR: 'Nauru',
                    NP: 'Nepal',
                    NL: 'Netherlands',
                    AN: 'Netherlands Antilles',
                    NC: 'New Caledonia',
                    NZ: 'New Zealand',
                    NI: 'Nicaragua',
                    NE: 'Niger',
                    NG: 'Nigeria',
                    NU: 'Niue',
                    NF: 'Norfolk Island',
                    MP: 'Northern Mariana Islands',
                    NO: 'Norway',
                    OM: 'Oman',
                    PK: 'Pakistan',
                    PW: 'Palau',
                    PS: 'Palestinian Territory, Occupied',
                    PA: 'Panama',
                    PG: 'Papua New Guinea',
                    PY: 'Paraguay',
                    PE: 'Peru',
                    PH: 'Philippines',
                    PN: 'Pitcairn',
                    PL: 'Poland',
                    PT: 'Portugal',
                    PR: 'Puerto Rico',
                    QA: 'Qatar',
                    RO: 'Romania',
                    RU: 'Russia',
                    RW: 'Rwanda',
                    BL: 'Saint Barthelemy',
                    SH: 'Saint Helena',
                    KN: 'Saint Kitts And Nevis',
                    LC: 'Saint Lucia',
                    MF: 'Saint Martin',
                    PM: 'Saint Pierre And Miquelon',
                    VC: 'Saint Vincent And Grenadines',
                    WS: 'Samoa',
                    SM: 'San Marino',
                    ST: 'Sao Tome And Principe',
                    SA: 'Saudi Arabia',
                    SN: 'Senegal',
                    RS: 'Serbia',
                    SC: 'Seychelles',
                    SL: 'Sierra Leone',
                    SG: 'Singapore',
                    SK: 'Slovakia',
                    SI: 'Slovenia',
                    SB: 'Solomon Islands',
                    SO: 'Somalia',
                    ZA: 'South Africa',
                    GS: 'South Georgia And Sandwich Isl.',
                    ES: 'Spain',
                    LK: 'Sri Lanka',
                    SD: 'Sudan',
                    SR: 'Suriname',
                    SJ: 'Svalbard And Jan Mayen',
                    SZ: 'Swaziland',
                    SE: 'Sweden',
                    CH: 'Switzerland',
                    SY: 'Syrian Arab Republic',
                    TW: 'Taiwan',
                    TJ: 'Tajikistan',
                    TZ: 'Tanzania',
                    TH: 'Thailand',
                    TL: 'Timor-Leste',
                    TG: 'Togo',
                    TK: 'Tokelau',
                    TO: 'Tonga',
                    TT: 'Trinidad And Tobago',
                    TN: 'Tunisia',
                    TR: 'Turkey',
                    TM: 'Turkmenistan',
                    TC: 'Turks And Caicos Islands',
                    TV: 'Tuvalu',
                    UG: 'Uganda',
                    UA: 'Ukraine',
                    AE: 'United Arab Emirates',
                    GB: 'United Kingdom',
                    US: 'United States',
                    UM: 'United States Outlying Islands',
                    UY: 'Uruguay',
                    UZ: 'Uzbekistan',
                    VU: 'Vanuatu',
                    VE: 'Venezuela',
                    VN: 'Vietnam',
                    VG: 'Virgin Islands, British',
                    VI: 'Virgin Islands, U.S.',
                    WF: 'Wallis And Futuna',
                    EH: 'Western Sahara',
                    YE: 'Yemen',
                    ZM: 'Zambia',
                    ZW: 'Zimbabwe'
                };

            const country_to_currency = {
	'AFGHANISTAN':'AFN', 
	'ALBANIA':'ALL', 
	'ALGERIA':'DZD', 
	'AMERICAN SAMOA':'USD', 
	'ANDORRA':'EUR', 
	'ANGOLA':'AOA', 
	'ANGUILLA':'XCD', 
	'ANTARCTICA':'', 
	'ANTIGUA AND BARBUDA':'XCD', 
	'ARGENTINA':'ARS', 
	'ARMENIA':'AMD', 
	'ARUBA':'AWG', 
	'AUSTRALIA':'AUD', 
	'AUSTRIA':'EUR', 
	'AZERBAIJAN':'AZN', 
	'BAHAMAS (THE)':'BSD', 
	'BAHRAIN':'BHD', 
	'BANGLADESH':'BDT', 
	'BARBADOS':'BBD', 
	'BELARUS':'BYN', 
	'BELGIUM':'EUR', 
	'BELIZE':'BZD', 
	'BENIN':'XOF', 
	'BERMUDA':'BMD', 
	'BHUTAN':'BTN', 
	'BHUTAN':'INR', 
	'BOLIVIA':'BOB', 
	'BONAIRE, SINT EUSTATIUS AND SABA':'USD', 
	'BOSNIA AND HERZEGOVINA':'BAM', 
	'BOTSWANA':'BWP', 
	'BOUVET ISLAND':'NOK', 
	'BRAZIL':'BRL', 
	'BRITISH INDIAN OCEAN TERRITORY (THE)':'USD', 
	'BRUNEI DARUSSALAM':'BND', 
	'BULGARIA':'BGN', 
	'BURKINA FASO':'XOF', 
	'BURUNDI':'BIF', 
	'CABO VERDE':'CVE', 
	'CAMBODIA':'KHR', 
	'CAMEROON':'XAF', 
	'CANADA':'CAD', 
	'CAYMAN ISLANDS (THE)':'KYD', 
	'CENTRAL AFRICAN REPUBLIC (THE)':'XAF', 
	'CHAD':'XAF', 
	'CHILE':'CLF', 
	'CHILE':'CLP', 
	'CHINA':'CNY', 
	'CHRISTMAS ISLAND':'AUD', 
	'COCOS (KEELING) ISLANDS (THE)':'AUD', 
	'COLOMBIA':'COU', 
	'COMOROS (THE)':'KMF', 
	'CONGO (THE DEMOCRATIC REPUBLIC OF THE)':'CDF', 
	'CONGO (THE)':'XAF', 
	'COOK ISLANDS (THE)':'NZD', 
	'COSTA RICA':'CRC', 
	'CROATIA':'HRK', 
	'CUBA':'CUC', 
	'CUBA':'CUP', 
	'CURAÇAO':'ANG', 
	'CYPRUS':'EUR', 
    'CZECHIA':'CZK',
	"CÔTE D'IVOIRE":'XOF', 
	'DENMARK':'DKK', 
	'DJIBOUTI':'DJF', 
	'DOMINICA':'XCD', 
	'DOMINICAN REPUBLIC':'USD', 
	'ECUADOR':'USD', 
	'EGYPT':'EGP', 
	'EL SALVADOR':'SVC', 
	'EL SALVADOR':'USD', 
	'EQUATORIAL GUINEA':'XAF', 
	'ERITREA':'ERN', 
	'ESTONIA':'EUR', 
	'ETHIOPIA':'ETB', 
	'EUROPEAN UNION':'EUR', 
	'FALKLAND ISLANDS (THE) {MALVINAS}':'FKP', 
	'FAROE ISLANDS (THE)':'DKK', 
	'FIJI':'FJD', 
	'FINLAND':'EUR', 
	'FRANCE':'EUR', 
	'FRENCH GUIANA':'EUR', 
	'FRENCH POLYNESIA':'XPF', 
	'FRENCH SOUTHERN TERRITORIES (THE)':'EUR', 
	'GABON':'XAF', 
	'GAMBIA (THE)':'GMD', 
	'GEORGIA':'GEL', 
	'GERMANY':'EUR', 
	'GHANA':'GHS', 
	'GIBRALTAR':'GIP', 
	'GREECE':'EUR', 
	'GREENLAND':'DKK', 
	'GRENADA':'XCD', 
	'GUADELOUPE':'EUR', 
	'GUAM':'USD', 
	'GUATEMALA':'GTQ', 
	'GUERNSEY':'GBP', 
	'GUINEA':'GNF', 
	'GUINEA-BISSAU':'XOF', 
	'GUYANA':'GYD', 
	'HAITI':'HTG', 
	'HAITI':'USD', 
	'HEARD ISLAND AND McDONALD ISLANDS':'AUD', 
	'HOLY SEE (THE)':'EUR', 
	'HONDURAS':'HNL', 
	'HONG KONG':'HKD', 
	'HUNGARY':'HUF', 
	'ICELAND':'ISK', 
	'INDIA':'INR', 
	'INDONESIA':'IDR', 
	'INTERNATIONAL MONETARY FUND (IMF) ':'XDR', 
	'IRAN (ISLAMIC REPUBLIC OF)':'IRR', 
	'IRAQ':'IQD', 
	'IRELAND':'EUR', 
	'ISLE OF MAN':'GBP', 
	'ISRAEL':'ILS', 
	'ITALY':'EUR', 
	'JAMAICA':'JMD', 
	'JAPAN':'JPY', 
	'JERSEY':'GBP', 
	'JORDAN':'JOD', 
	'KAZAKHSTAN':'KZT', 
	'KENYA':'KES', 
	'KIRIBATI':'AUD', 
    'SOUTH KOREA':'KRW', 
	'KUWAIT':'KWD', 
	'KYRGYZSTAN':'KGS', 
	'LAO PEOPLE’S DEMOCRATIC REPUBLIC (THE)':'LAK', 
	'LATVIA':'EUR', 
	'LEBANON':'LBP', 
	'LESOTHO':'LSL', 
	'LESOTHO':'ZAR', 
	'LIBERIA':'LRD', 
	'LIBYA':'LYD', 
	'LIECHTENSTEIN':'CHF', 
	'LITHUANIA':'EUR', 
	'LUXEMBOURG':'EUR', 
	'MACAO':'MOP', 
	'MADAGASCAR':'MGA', 
	'MALAWI':'MWK', 
	'MALAYSIA':'MYR', 
	'MALDIVES':'MVR', 
	'MALI':'XOF', 
	'MALTA':'EUR', 
	'MARSHALL ISLANDS (THE)':'USD', 
	'MARTINIQUE':'EUR', 
	'MAURITANIA':'MRU', 
	'MAURITIUS':'MUR', 
	'MAYOTTE':'EUR', 
	'MEMBER COUNTRIES OF THE AFRICAN DEVELOPMENT BANK GROUP':'XUA', 
	'MEXICO':'MX',
	'MICRONESIA (FEDERATED STATES OF)':'USD', 
	'MOLDOVA (THE REPUBLIC OF)':'MDL', 
	'MONACO':'EUR', 
	'MONGOLIA':'MNT', 
	'MONTENEGRO':'EUR', 
	'MONTSERRAT':'XCD', 
	'MOROCCO':'MAD', 
	'MOZAMBIQUE':'MZN', 
	'MYANMAR':'MMK', 
	'NAMIBIA':'NAD', 
	'NAMIBIA':'ZAR', 
	'NAURU':'AUD', 
	'NEPAL':'NPR', 
	'NETHERLANDS':'EUR', 
	'NEW CALEDONIA':'XPF', 
	'NEW ZEALAND':'NZD', 
	'NICARAGUA':'NIO', 
	'NIGER (THE)':'XOF', 
	'NIGERIA':'NGN', 
	'NIUE':'NZD', 
	'NORFOLK ISLAND':'AUD', 
	'NORTHERN MARIANA ISLANDS (THE)':'USD', 
	'NORWAY':'NOK', 
	'OMAN':'OMR', 
	'PAKISTAN':'PKR', 
	'PALAU':'USD', 
	'PALESTINE, STATE OF':'', 
	'PANAMA':'PAB', 
	'PANAMA':'USD', 
	'PAPUA NEW GUINEA':'PGK', 
	'PARAGUAY':'PYG', 
	'PERU':'PEN', 
	'PHILIPPINES':'PHP', 
	'PITCAIRN':'NZD', 
	'POLAND':'PLN', 
	'PORTUGAL':'EUR', 
	'PUERTO RICO':'USD', 
	'QATAR':'QAR', 
	'REPUBLIC OF NORTH MACEDONIA':'MKD', 
	'ROMANIA':'RON', 
	'RUSSIA':'RUB', 
	'RWANDA':'RWF', 
	'RÉUNION':'EUR', 
	'SAINT BARTHÉLEMY':'EUR', 
	'SAINT HELENA, ASCENSION AND TRISTAN DA CUNHA':'SHP', 
	'SAINT KITTS AND NEVIS':'XCD', 
	'SAINT LUCIA':'XCD', 
	'SAINT MARTIN (FRENCH PART)':'EUR', 
	'SAINT PIERRE AND MIQUELON':'EUR', 
	'SAINT VINCENT AND THE GRENADINES':'XCD', 
	'SAMOA':'WST', 
	'SAN MARINO':'EUR', 
	'SAO TOME AND PRINCIPE':'STN', 
	'SAUDI ARABIA':'SAR', 
	'SENEGAL':'XOF', 
	'SERBIA':'RSD', 
	'SEYCHELLES':'SCR', 
	'SIERRA LEONE':'SLL', 
	'SINGAPORE':'SGD', 
	'SINT MAARTEN (DUTCH PART)':'ANG', 
	'SISTEMA UNITARIO DE COMPENSACION REGIONAL DE PAGOS "SUCRE"':'XSU', 
	'SLOVAKIA':'EUR', 
	'SLOVENIA':'EUR', 
	'SOLOMON ISLANDS':'SBD', 
	'SOMALIA':'SOS', 
	'SOUTH AFRICA':'ZAR', 
	'SOUTH GEORGIA AND THE SOUTH SANDWICH ISLANDS':'', 
	'SOUTH SUDAN':'SSP', 
	'SPAIN':'EUR', 
	'SRI LANKA':'LKR', 
	'SUDAN (THE)':'SDG', 
	'SURINAME':'SRD', 
	'SVALBARD AND JAN MAYEN':'NOK', 
	'SWAZILAND':'SZL', 
	'SWEDEN':'SEK', 
	'SWITZERLAND':'CHE', 
	'SWITZERLAND':'CHF', 
	'SWITZERLAND':'CHW', 
	'SYRIAN ARAB REPUBLIC':'SYP', 
	'TAIWAN':'TWD', 
	'TAJIKISTAN':'TJS', 
	'TANZANIA, UNITED REPUBLIC OF':'TZS', 
	'THAILAND':'THB', 
	'TIMOR-LESTE':'USD', 
	'TOGO':'XOF', 
	'TOKELAU':'NZD', 
	'TONGA':'TOP', 
	'TRINIDAD AND TOBAGO':'TTD', 
	'TUNISIA':'TND', 
	'TURKEY':'TRY', 
	'TURKMENISTAN':'TMT', 
	'TURKS AND CAICOS ISLANDS (THE)':'USD', 
	'TUVALU':'AUD', 
	'UGANDA':'UGX', 
	'UKRAINE':'UAH', 
	'UNITED ARAB EMIRATES':'AED', 
	'UNITED KINGDOM':'GBP', 
	'UNITED STATES OUTLYING ISLANDS':'USD', 
	'UNITED STATES':'USD',
	'URUGUAY':'UYI', 
	'URUGUAY':'UYU', 
	'UZBEKISTAN':'UZS', 
	'VANUATU':'VUV', 
	'VENEZUELA':'VEF', 
	'VIETNAM':'VND', 
	'VIRGIN ISLANDS (BRITISH)':'USD', 
	'VIRGIN ISLANDS (U.S.)':'USD', 
	'WALLIS AND FUTUNA':'XPF', 
	'WESTERN SAHARA':'MAD', 
	'YEMEN':'YER', 
	'ZAMBIA':'ZMW', 
	'ZIMBABWE':'ZWL', 
	'ÅLAND ISLANDS':'EUR'
}

    </script>
    
    <div class="overlay"></div>
    <div class="spanner">
      <div class="loader"></div>
        <p>Loading book data. Please be patient.</p>
        <p class="fun_facts"></p>
    </div>

    <div class="sticky-entry">
        <h1 style="text-align: center">Google Play Books Global Price Chart</h1>
        <h3 style="text-align: center"><a title="(opens in a new window)" target=_blank href="https://support.google.com/books/partner/table/6052428?hl=en">View supported countries and currencies for Google Play Books</a></h3>
        <p style="text-align: center"><em>Instructions:</em> Enter the Book ID then press the 'Show Data' button.</p>
        <p style="text-align: center"><u>Processing may take several minutes to complete. Please be patient.</u></p>
        <form>
            <p>
                <label>Book ID:</label>
                <input type="text" name="book_id" />
                <small style="display: inline;">(eg: https://play.google.com/store/books/details/M_Ravenel_The_Arrangement?id=<u>cmYYEAAAQBAJ</u> &#8592; The underlined part is the ID)</small>
            </p>
            <p>
                <label>Select Country(ies):</label>
                <small><strong>(Note: selecting a lot of countries may slow the load time and/or may cause timeout errors)</strong></small>
            </p>
            <p>
                <select style="display: block;" multiple="multiple" id="country_select" name="country_selectt[]"></select>
            <p>
            <p>
                <button type="button" name="submit" onclick="get_prices();">Show Data</button>
            </p>
        </form>
        <div id="progress"></div>
    </div>
    <table class="book-table" id="book-table" name="book-table"></table>
    </body>

    <footer>
        <script>
            // Populate country multiselect box
            for (i in countries) $('select#country_select').append(`<option value="${i}">${countries[i]}</option>`);
            $('#country_select').select2({
                multiple: true, 
                search: true, 
                placeholder: 'Select one or more countries...', 
                allowClear: true,
                width: '50%',
                closeOnSelect: false,
            });
            
            const loadingBar = document.getElementById('progress');

            async function task() {
                return new Promise(res => {
                    setTimeout(res, Math.random() * 5000);
                });
            }

            function loadingBarStatus(current, max) {
                loadingBar.textContent = `Loading ${current} of ${max} ${max === 1 ? 'row' : 'rows'}`;
                if (current === max) {
                    $("div.spanner").removeClass("show");
                    $("div.overlay").removeClass("show");
                } else {
                    $("div.spanner").addClass("show");
                    $("div.overlay").addClass("show");
                }
            }

            function sortTable(n) {
                var table;
                var rows; 
                var switching; 
                var i;
                var x;
                    var y; 
                    var shouldSwitch; 
                    var dir; 
                    var switchcount = 0;
                table = document.getElementById("book-table");
                switching = true;
                // Set the sorting direction to ascending:
                dir = "asc";
                /* Make a loop that will continue until
                no switching has been done: */
                while (switching) {
                    // Start by saying: no switching is done:
                    switching = false;
                    rows = table.rows;
                    /* Loop through all table rows (except the
                    first, which contains table headers): */
                    for (i = 1; i < (rows.length - 1); i++) {
                    // Start by saying there should be no switching:
                    shouldSwitch = false;
                    /* Get the two elements you want to compare,
                    one from current row and one from the next: */
                    x = rows[i].getElementsByTagName("td")[n];
                    y = rows[i + 1].getElementsByTagName("td")[n];
                    /* Check if the two rows should switch place,
                    based on the direction, asc or desc: */
                    if (dir == "asc") {
                        if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                        // If so, mark as a switch and break the loop:
                        shouldSwitch = true;
                        break;
                        }
                    } else if (dir == "desc") {
                        if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
                        // If so, mark as a switch and break the loop:
                        shouldSwitch = true;
                        break;
                        }
                    }
                    }
                    if (shouldSwitch) {
                    /* If a switch has been marked, make the switch
                    and mark that a switch has been done: */
                    rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                    switching = true;
                    // Each time a switch is done, increase this count by 1:
                    switchcount ++;
                    } else {
                    /* If no switching has been done AND the direction is "asc",
                    set the direction to "desc" and run the while loop again. */
                    if (switchcount == 0 && dir == "asc") {
                        dir = "desc";
                        switching = true;
                    }
                    }
                }
            }
        </script>
    </footer>
</html>